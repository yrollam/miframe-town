<html>

<head>
    <title>Calypso test site</title>
</head>
<style>
    custom-ele,
    custom-ele-with-slot {
        display: inline-block;
        padding: 40px;
        border: 1px solid;
        margin-top: 30px;
    }
</style>

<body>
    <div class="title">Test site for web apps inside an extension-enabled sub</div>
    <div class="subtext">this site links to subid 5691975521009664 on pendo-calypso</div>

    <script id="pendo-snippet">
        const shouldAddAgent = !window.location.search.includes('no-agent');
        if (shouldAddAgent) {
            initializeSnippetOnTargetWindow(window);
        }

        function initializeSnippetOnTargetWindow(window) {
            const document = window.document;

            // The idea here is that this is the literal copy-pasted snippet
            // Thats why I override window/document above, so we can shift the target window/document of the
            // snippet to the contentWindow/contentDocument of the iframe
            (function (apiKey) {
                (function (p, e, n, d, o) {

                    var v, w, x, y, z; o = p[d] = p[d] || {}; o._q = [];
                    v = ['initialize', 'identify', 'updateOptions', 'pageLoad']; for (w = 0, x = v.length; w < x; ++w)(function (m) {
                        o[m] = o[m] || function () {o._q[m === v[0] ? 'unshift' : 'push']([m].concat([].slice.call(arguments, 0)));};
                    })(v[w]);
                    y = e.createElement(n); y.async = !0; y.src = 'https://pendo-calypso-static.storage.googleapis.com/agent/static/' + apiKey + '/pendo.js';
                    z = e.getElementsByTagName(n)[0]; z.parentNode.insertBefore(y, z);
                })(window, document, 'script', 'pendo');

                var url = window.location.search;
                var queryString = {};
                // from https://stevenbenner.com/2010/03/javascript-regex-trick-parse-a-query-string-into-an-object/
                url.replace(
                    new RegExp("([^?=&]+)(=([^&]*))?", "g"),
                    function ($0, $1, $2, $3) {
                        queryString[$1] = $3;
                    }
                );
                window.pendo.initialize({
                    visitor: {
                        id: queryString.visitor || 'testuser@pendo'
                    },
                    disableGuideCenterContentSearch: true,
                    apiKey: 'f2b2a03f-bf37-43d3-75cd-d53d35137ed8',
                    account: {
                        id: 12345,
                        city: 'Raleigh',
                        zipCode: '27601'
                    }
                });

            })('f2b2a03f-bf37-43d3-75cd-d53d35137ed8');

        }

    </script>
</body>

</html>